// Uygulama State'i
const appState = {
    currentUser: null,
    currentEmployeeIndex: null
};

// Sayfa Yüklendiğinde
document.addEventListener('DOMContentLoaded', () => {
    initLogin();
    checkAuth();
});

// Giriş İşlemleri
function initLogin() {
    document.getElementById('loginBtn').addEventListener('click', login);
    document.getElementById('password').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') login();
    });
}

function login() {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    
    if (username === "hekim" && password === "Sifre123!") {
        localStorage.setItem('authToken', 'valid-token');
        showMainView();
    } else {
        document.getElementById('loginError').textContent = "Hatalı giriş bilgileri!";
    }
}

function checkAuth() {
    if (localStorage.getItem('authToken')) {
        showMainView();
    }
}

function showMainView() {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('mainApp').style.display = 'block';
}

// EK-2 Formu Göster
function showEk2Modal(employeeIndex) {
    const docId = '1i_4ZaDcmsPYuLDzGwAdxuD5CYgfGaRHG';
    const viewerUrl = `https://docs.google.com/document/d/${docId}/preview?embedded=true&rm=minimal`;
    
    document.getElementById('ek2FormContent').innerHTML = `
        <div class="embed-responsive">
            <iframe src="${viewerUrl}" loading="lazy"></iframe>
        </div>
        <div class="alert alert-info mt-3">
            Form yüklenmezse <a href="https://docs.google.com/document/d/${docId}" target="_blank">buraya tıklayın</a>.
        </div>
    `;
    
    new bootstrap.Modal(document.getElementById('ek2Modal')).show();
}

// TEST İÇİN EK BUTON (Silinebilir)
document.addEventListener('DOMContentLoaded', () => {
    if (document.getElementById('mainApp')) {
        const testBtn = document.createElement('button');
        testBtn.className = 'btn btn-success m-3';
        testBtn.textContent = 'EK-2 Test Aç';
        testBtn.onclick = () => showEk2Modal(0);
        document.getElementById('mainApp').prepend(testBtn);
    }
});
